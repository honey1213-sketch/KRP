<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KRP Bank — Send Money</title>
<style>
body{margin:0;background:radial-gradient(circle at top,#0d1226,#05060d);font-family:Poppins,Arial,sans-serif;color:#fff;min-height:100vh}
*{box-sizing:border-box;transition:0.2s}
.header{padding:18px 20px;text-align:center;font-weight:700;font-size:26px;background:rgba(255,255,255,0.04);border-bottom:1px solid rgba(255,255,255,0.06);backdrop-filter:blur(8px)}
.user-list{display:flex;gap:12px;padding:16px;overflow-x:auto}
.user-btn{min-width:120px;padding:14px;border-radius:14px;border:none;background:rgba(255,255,255,0.08);color:#fff;font-weight:700;cursor:pointer}
.user-btn.active{box-shadow:0 0 20px rgba(0,0,0,0.6);transform:translateY(-2px)}
.card{margin:18px;background:rgba(255,255,255,0.06);border-radius:18px;padding:22px;backdrop-filter:blur(12px)}
.name{font-size:26px;font-weight:800}
.balance{font-size:44px;margin-top:12px;font-weight:800;text-shadow:0 0 14px #00d4ff}
.tag{display:inline-block;margin-top:12px;padding:8px 14px;border-radius:10px;font-weight:700}
.low{background:#d62828}
.medium{background:#f4a261;color:#000}
.high{background:#2a9d8f;color:#000}
.send-btn{margin-top:18px;padding:14px;border-radius:12px;width:100%;border:none;background:linear-gradient(45deg,#00d4ff,#0051ff);font-weight:800;font-size:18px;cursor:pointer}
.popup{position:fixed;inset:0;background:rgba(0,0,0,0.65);display:none;align-items:center;justify-content:center;z-index:50}
.popup-box{width:92%;max-width:420px;background:rgba(10,10,10,0.92);padding:22px;border-radius:18px;text-align:center;box-shadow:0 0 22px rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,0.06)}
select,.input{width:100%;padding:12px;margin-top:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.06);color:#fff;font-size:16px}
.receipt{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#fff;color:#000;padding:28px 22px;border-radius:6px;width:320px;text-align:left;font-family:monospace;font-size:13px;box-shadow:0 0 40px rgba(0,0,0,0.55);border:1px dashed #444;z-index:9999}
.transfer-anim{position:fixed;left:50%;top:40%;transform:translate(-50%,-50%);background:linear-gradient(90deg,#00d4ff,#1f51ff);padding:14px 20px;border-radius:999px;color:#000;font-weight:800;display:none}
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#ff3b30;color:#fff;padding:12px 18px;border-radius:10px;font-weight:800;z-index:9998}
.history-panel{position:fixed;left:50%;bottom:0;transform:translateX(-50%);background:rgba(0,0,0,0.85);padding:18px;border-radius:16px;width:95%;max-width:600px;max-height:50vh;overflow-y:auto;box-shadow:0 0 28px rgba(0,0,0,0.8);font-size:14px;z-index:999;backdrop-filter:blur(6px);}
.history-panel h4{margin-top:0;margin-bottom:12px;font-size:18px;text-align:center;color:#00d4ff}
.history-item{border-bottom:1px solid rgba(255,255,255,0.3);padding:8px 0}
.history-item:last-child{border-bottom:none}
.history-item div{margin:2px 0}
</style>
</head>
<body>
<div class="header">KRP BANK</div>
<div class="user-list" id="userList"></div>
<div class="card" id="infoCard">
  <div class="name" id="cardName">Choose User</div>
  <div class="balance" id="cardBalance">—</div>
  <div class="tag" id="cardTag"></div>
  <button class="send-btn" id="openSendBtn">Send Money</button>
</div>
<div class="popup" id="sendPopup">
  <div class="popup-box">
    <h3>Send Money</h3>
    <label>From</label>
    <select id="senderSelect"></select>
    <label>To</label>
    <select id="receiverSelect"></select>
    <input id="amount" class="input" type="number" placeholder="Amount" />
    <input id="pin" class="input" type="password" placeholder="PIN" />
    <button class="send-btn" id="confirmBtn">Confirm</button>
    <button class="send-btn" id="cancelBtn" style="background:#444;margin-top:8px;">Cancel</button>
  </div>
</div>
<div class="transfer-anim" id="transferAnim">Sending...</div>
<div class="history-panel" id="historyPanel"><h4>Transaction History</h4></div>
<script>
const users=['Kartikey','Ramshankar','Pranay'];
const pins={Kartikey:'1213',Ramshankar:'1415',Pranay:'1617'};

// Persistent storage: load or initialize only if not exist
let balances=JSON.parse(localStorage.getItem('krp_balances'));
if(!balances){balances={Kartikey:20000,Ramshankar:15000,Pranay:15000}; localStorage.setItem('krp_balances',JSON.stringify(balances));}

let history=JSON.parse(localStorage.getItem('krp_history'));
if(!history){history=[]; localStorage.setItem('krp_history',JSON.stringify(history));}

let current=null;

function saveBalances(){localStorage.setItem('krp_balances',JSON.stringify(balances));}
function saveHistory(){localStorage.setItem('krp_history',JSON.stringify(history)); renderHistory();}
function formatRs(n){return '₹ '+Number(n).toLocaleString();}

function renderUsers(){
  const container=document.getElementById('userList'); container.innerHTML='';
  users.forEach(u=>{
    const btn=document.createElement('button'); btn.className='user-btn'; btn.textContent=u;
    btn.addEventListener('click',()=>selectUser(u,btn));
    container.appendChild(btn);
  });
}
function selectUser(name,btn){
  current=name;
  document.querySelectorAll('.user-btn').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
  renderCard(); renderHistory();
}
function renderCard(){
  const nameEl=document.getElementById('cardName');
  const balEl=document.getElementById('cardBalance');
  const tagEl=document.getElementById('cardTag');
  if(!current){nameEl.textContent='Choose User'; balEl.textContent='—'; tagEl.textContent=''; return;}
  nameEl.textContent=current;
  const amt=balances[current];
  animateNumber(balEl,parseBalance(balEl.textContent)||0,amt);
  tagEl.className='tag '+(amt<5000?'low':amt<15000?'medium':'high');
  tagEl.textContent=amt<5000?'LOW':amt<15000?'MEDIUM':'HIGH';
}
function parseBalance(t){if(!t)return 0; const m=t.replace(/[^0-9]/g,''); return m?parseInt(m,10):0;}
function animateNumber(el,from,to,duration=700){const start=performance.now();function step(ts){const t=Math.min(1,(ts-start)/duration); el.textContent=formatRs(Math.floor(from+(to-from)*t)); if(t<1) requestAnimationFrame(step);} requestAnimationFrame(step);}

// Popup handling
document.getElementById('openSendBtn').addEventListener('click',()=>{
  if(!current)return showToast('Select a user first');
  const s=document.getElementById('senderSelect'); const r=document.getElementById('receiverSelect');
  s.innerHTML=''; r.innerHTML='';
  users.forEach(u=>{
    const o1=document.createElement('option');o1.value=u;o1.text=`${u} — ${formatRs(balances[u])}`; s.appendChild(o1);
    const o2=document.createElement('option');o2.value=u;o2.text=`${u} — ${formatRs(balances[u])}`; r.appendChild(o2);
  });
  s.value=current;
  document.getElementById('sendPopup').style.display='flex';
});
document.getElementById('cancelBtn').addEventListener('click',()=>document.getElementById('sendPopup').style.display='none');
function showToast(msg,time=2600){const t=document.createElement('div');t.className='toast';t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),time);}

// Confirm transfer
document.getElementById('confirmBtn').addEventListener('click',()=>{
  const sender=document.getElementById('senderSelect').value;
  const receiver=document.getElementById('receiverSelect').value;
  const amount=Number(document.getElementById('amount').value);
  const pin=document.getElementById('pin').value;
  if(!sender||!receiver)return showToast('Select sender and receiver');
  if(sender===receiver)return showToast('Cannot send to self');
  if(pin!==pins[sender])return showToast('Incorrect PIN for '+sender);
  if(!amount||amount<=0)return showToast('Enter valid amount');
  if(amount>balances[sender])return showToast('Insufficient balance');

  document.getElementById('sendPopup').style.display='none';
  const anim=document.getElementById('transferAnim'); anim.textContent=`${sender} → ${receiver}`; anim.style.display='block';
  setTimeout(()=>{
    const prevS=balances[sender], prevR=balances[receiver];
    balances[sender]-=amount; balances[receiver]+=amount;
    saveBalances();
    if(current===sender)animateNumber(document.getElementById('cardBalance'),prevS,balances[sender]);
    else if(current===receiver)animateNumber(document.getElementById('cardBalance'),prevR,balances[receiver]);
    const txn={sender,receiver,amount,time:new Date().toLocaleString()}; history.push(txn);
    saveHistory();
    showReceipt(sender,receiver,amount);
    setTimeout(()=>anim.style.display='none',900);
  },500);
  document.getElementById('amount').value=''; document.getElementById('pin').value='';
});

function showReceipt(sender,receiver,amount){
  const r=document.createElement('div'); r.className='receipt';
  const now=new Date();
  r.innerHTML=`<h4>KRP BANK RECEIPT</h4><div class='small'>${now.toLocaleString()}</div><pre>-------------------------------------</pre>
  <div><strong>FROM:</strong> ${sender}</div><div><strong>TO:</strong> ${receiver}</div>
  <div class='amount'>${formatRs(amount)}</div><pre>-------------------------------------</pre>
  <div style='text-align:center;margin-top:8px;font-weight:800'>Payment Successful ✓</div>`;
  document.body.appendChild(r);
  const audio=new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg'); audio.play();
  setTimeout(()=>r.remove(),5500);
}

function renderHistory(){
  const panel=document.getElementById('historyPanel');
  panel.innerHTML='<h4>Transaction History</h4>';
  const filtered=history.filter(h=>h.sender===current||h.receiver===current).slice().reverse();
  if(filtered.length===0){panel.innerHTML+='<div>No transactions yet</div>';return;}
  filtered.forEach(txn=>{
    const div=document.createElement('div'); div.className='history-item';
    div.innerHTML=`<div><strong>${txn.sender}</strong> → <strong>${txn.receiver}</strong></div><div>${formatRs(txn.amount)}</div><div style='opacity:0.7;font-size:12px'>${txn.time}</div>`;
    panel.appendChild(div);
  });
}

renderUsers();
if(users.length) selectUser(users[0],document.querySelector('.user-btn'));
renderHistory();
</script>
</body>
</html>
