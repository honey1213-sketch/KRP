
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KRP Bank</title>

<style>
:root{--ease:cubic-bezier(.22,.61,.36,1)}
*{box-sizing:border-box}

body{
 margin:0;
 min-height:100vh;
 background:#000;
 font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif;
 color:#fff;
}

/* HEADER */
.header{
 text-align:center;
 padding:22px;
 font-weight:700;
}

/* USERS */
.users{
 display:flex;
 gap:12px;
 padding:0 20px 12px;
 overflow-x:auto;
}
.user{
 padding:14px 20px;
 border-radius:18px;
 background:rgba(255,255,255,.1);
 cursor:pointer;
}
.user.active{background:#fff;color:#000}

/* BALANCE */
.apple-card{
 margin:20px;
 padding:28px;
 border-radius:28px;
 background:rgba(255,255,255,.12);
 backdrop-filter:blur(30px);
 text-align:center;
}
.apple-label{font-size:14px;opacity:.7}
.apple-balance{font-size:52px;font-weight:800;margin-top:8px}
.apple-balance span{font-size:26px;opacity:.6}
.apple-user{opacity:.7;margin-top:6px}

/* SEND */
.send-btn{
 margin:24px 20px;
 width:calc(100% - 40px);
 padding:18px;
 border-radius:22px;
 border:none;
 background:#fff;
 color:#000;
 font-weight:700;
}

/* PAY SHEET */
.sheet{
 position:fixed;
 left:0;right:0;bottom:-100%;
 background:#111;
 border-radius:30px 30px 0 0;
 padding:26px;
 transition:.45s var(--ease);
}
.sheet.show{bottom:0}

.sheet input,.sheet select{
 width:100%;
 margin-top:14px;
 padding:15px;
 border-radius:16px;
 border:none;
 background:rgba(255,255,255,.12);
 color:#fff;
}

.pay-btn{
 margin-top:22px;
 height:56px;
 border-radius:30px;
 background:#000;
 display:flex;
 align-items:center;
 justify-content:center;
 font-weight:700;
}

/* RECEIPT */
.apple-receipt{
 position:fixed;
 inset:0;
 background:#f2f2f7;
 display:flex;
 justify-content:center;
 align-items:flex-start;
 padding-top:40px;
 z-index:9999;
}

.receipt-card{
 width:100%;
 max-width:420px;
 padding:18px;
 color:#000;
}

.top{
 color:#007aff;
 font-size:17px;
 cursor:pointer;
}

.big-amount{
 font-size:48px;
 font-weight:800;
 text-align:center;
 margin-top:18px;
}

.sub{
 text-align:center;
 color:#666;
 font-size:14px;
 margin-top:6px;
}

.status-box{
 background:#fff;
 border-radius:16px;
 padding:16px;
 margin-top:22px;
 font-size:16px;
}
.status-box.fail{color:#ff3b30}

.line{
 display:flex;
 justify-content:space-between;
 margin-top:12px;
 font-weight:600;
}

.txid{
 margin-top:22px;
 font-size:13px;
 color:#888;
}
</style>
</head>

<body>

<div class="header">KRP BANK</div>
<div class="users" id="users"></div>

<div class="apple-card">
 <div class="apple-label">Available Balance</div>
 <div class="apple-balance" id="balance"><span>â‚¹</span>â€”</div>
 <div class="apple-user" id="username">Select User</div>
</div>

<button class="send-btn" id="openPay">Send with KRP Pay</button>

<div class="sheet" id="sheet">
 <select id="sender"></select>
 <select id="receiver"></select>
 <input id="amount" type="number" placeholder="Amount">
 <input id="pin" type="password" placeholder="PIN">
 <div class="pay-btn" id="payBtn">Pay</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, update, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const app=initializeApp({
 apiKey:"AIzaSyChKPlzj9uVm3KBi4iPOz8xQHtC6v0Lt4E",
 databaseURL:"https://krp-bank-default-rtdb.firebaseio.com/"
});
const db=getDatabase(app);

const usersArr=["Kartikey","Aryan","Pranay","BANK"];
const pins={Aryan:"9892",Pranay:"8081",BANK:"1990"};
let balances={},current=null;

usersArr.forEach(u=>{
 const d=document.createElement("div");
 d.className="user";
 d.textContent=u;
 d.onclick=()=>{
  document.querySelectorAll(".user").forEach(x=>x.classList.remove("active"));
  d.classList.add("active");
  current=u;
  username.textContent=u;
  render();
 };
 users.appendChild(d);
});

onValue(ref(db,"balances"),s=>{balances=s.val()||{};render()});

function render(){
 if(!current)return;
 if(current==="Kartikey"){balance.textContent="CLOSED";return}
 if(current==="BANK"){balance.textContent="N/A";return}
 balance.innerHTML="<span>â‚¹</span>"+(balances[current]||0).toLocaleString();
}

openPay.onclick=()=>{
 sheet.classList.add("show");
 sender.innerHTML=receiver.innerHTML="";
 usersArr.forEach(u=>{
  if(u!=="Kartikey"){
   sender.innerHTML+=`<option>${u}</option>`;
   receiver.innerHTML+=`<option>${u}</option>`;
  }
 });
};

payBtn.onclick=()=>{
 const s=sender.value,r=receiver.value,a=+amount.value,p=pin.value;
 const ok=!(s===r||a<=0||p!==pins[s]||(s!=="BANK"&&a>(balances[s]||0)));

 if(ok){
  if(s!=="BANK")balances[s]-=a;
  balances[r]=(balances[r]||0)+a;
  update(ref(db,"balances"),balances);

  /* ðŸ”‘ USER-WISE HISTORY */
  push(ref(db,"history/"+s),{
    to:r,
    amount:a,
    status:"SUCCESS",
    time:Date.now()
  });
 }else{
  push(ref(db,"history/"+s),{
    to:r,
    amount:a,
    status:"FAILED",
    time:Date.now()
  });
 }

 showReceipt({amount:a,sender:s,receiver:r,status:ok?"SUCCESS":"FAILED"});
 sheet.classList.remove("show");
};

function showReceipt({amount,sender,receiver,status}){
 const success=status==="SUCCESS";
 const w=document.createElement("div");
 w.className="apple-receipt";
 w.innerHTML=`
  <div class="receipt-card">
   <div class="top" id="backBtn">â€¹ Back</div>
   <div class="big-amount">â‚¹${amount.toLocaleString()}</div>
   <div class="sub">To ${receiver}<br>${new Date().toLocaleString()}</div>
   <div class="status-box ${success?"":"fail"}">
    <b>Status:</b> ${success?"Completed":"Failed"}
    <div style="font-size:13px;color:#888;margin-top:4px">
     Sent from ${sender}
    </div>
   </div>
   <div class="line"><span>Sent</span><span>â‚¹${amount.toLocaleString()}</span></div>
   <div class="txid">Transaction ID<br><b>${Math.random().toString(36).slice(2,14)}</b></div>
  </div>
 `;
 document.body.appendChild(w);

 w.querySelector("#backBtn").onclick=()=>w.remove();
}
</script>
</body>
</html>
